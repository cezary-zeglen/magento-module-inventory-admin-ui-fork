<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AddProductToCartAfterCancelOrderConfigurableProductCustomStockTest" extends="AdminOrderCreatedForGuestCustomerWithConfigurableProductWithDropDownAttributeViaTheAdminTest">
        <annotations>
            <stories value="Configurable Product Custom Stock."/>
            <title value="Add Configurable Product to Cart after Cancel Order on Custom Stock."/>
            <description value="Verify customer able to add configurable product to cart with correct quantity after cancel order on custom stock."/>
            <testCaseId value="https://app.hiptest.com/projects/69435/test-plan/folders/735249/scenarios/1474637"/>
            <severity value="CRITICAL"/>
            <group value="msi"/>
            <group value="multi_mode"/>
        </annotations>

        <!--Cancel order-->
        <amOnPage url="{{AdminOrdersPage.url}}" stepKey="navigateToOrderListPage"/>
        <waitForLoadingMaskToDisappear stepKey="waitOrderListPageLoad"/>
        <fillField selector="{{AdminOrdersGridSection.search}}" userInput="{$grabTheOrderId1}" stepKey="searchOrder"/>
        <click selector="{{AdminOrdersGridSection.submitSearch}}" stepKey="submitSearch"/>
        <waitForLoadingMaskToDisappear stepKey="waitFilteredOrderListPageLoad"/>
        <click selector="{{AdminOrdersGridSection.firstRow}}" stepKey="navigateToOrderViewPage"/>
        <waitForPageLoad stepKey="waitForOrderPage"/>
        <click selector="{{AdminOrderDetailsMainActionsSection.cancel}}" stepKey="clickCancelOrder"/>
        <waitForElement selector="{{AdminConfirmationModalSection.message}}" stepKey="waitForCancelConfirmation"/>
        <see selector="{{AdminConfirmationModalSection.message}}" userInput="Are you sure you want to cancel this order?" stepKey="seeConfirmationMessage"/>
        <click selector="{{AdminConfirmationModalSection.ok}}" stepKey="confirmOrderCancel"/>
        <see selector="{{AdminMessagesSection.success}}" userInput="You canceled the order." stepKey="seeCancelSuccessMessage"/>
        <!--Verify ability to add product ot cart after order cancellation.-->
        <actionGroup ref="LoginToStorefrontActionGroup" stepKey="loginAsCustomer">
            <argument name="Customer" value="$$createCustomer1$$" />
        </actionGroup>
        <!--Try add product to cart with improper quantity.-->
        <amOnPage url="{{StorefrontProductPage.url(ConfigurableMsiProduct.sku)}}" stepKey="navigateToProductPage"/>
        <selectOption selector="{{StorefrontConfigurableProductPage.productAttributeDropDown}}" userInput="{{colorProductAttribute2.name}}" stepKey="selectRedVariation"/>
        <fillField selector="{{StorefrontProductPageSection.qtyInput}}" userInput="101" stepKey="fillQuantity"/>
        <click selector="{{StorefrontProductPageSection.addToCartBtn}}" stepKey="addToCart"/>
        <waitForElementVisible selector="{{StorefrontProductPageSection.errorMsg}}" stepKey="waitForErrorMessage"/>
        <see selector="{{StorefrontProductPageSection.errorMsg}}" userInput="The requested qty is not available" stepKey="verifyErrorMessage"/>
        <!--Add 'red' variation with proper quantity-->
        <fillField selector="{{StorefrontProductPageSection.qtyInput}}" userInput="100" stepKey="refillQuantity"/>
        <click selector="{{StorefrontProductPageSection.addToCartBtn}}" stepKey="againAddToCart"/>
        <waitForElementVisible selector="{{StorefrontMessagesSection.success}}" stepKey="waitForSuccessMessage"/>
        <see selector="{{StorefrontMessagesSection.success}}" userInput="You added {{ConfigurableMsiProduct.name}} to your shopping cart." stepKey="verifySuccessMessage"/>
    </test>
</tests>
